# é¡¹ç›®ç»“æ„é‡ç»„è¯´æ˜

## ğŸ“‹ é‡ç»„æ¦‚è¦

é¡¹ç›®å·²ä»å•æ–‡ä»¶ç»“æ„é‡ç»„ä¸ºæ ‡å‡†çš„ Go é¡¹ç›®å¸ƒå±€ï¼Œéµå¾ªç¤¾åŒºæœ€ä½³å®è·µã€‚

## ğŸ”„ å˜æ›´å¯¹æ¯”

### ä¹‹å‰ï¼ˆå•æ–‡ä»¶ç»“æ„ï¼‰

```
backend/
â”œâ”€â”€ main.go              (748 è¡Œ)
â”œâ”€â”€ config.go
â”œâ”€â”€ models.go
â”œâ”€â”€ errors.go
â”œâ”€â”€ registry.go
â”œâ”€â”€ service.go
â”œâ”€â”€ adapter_apibay.go
â”œâ”€â”€ adapter_sample.go
â”œâ”€â”€ magnet.go
â””â”€â”€ utils.go
```

### ç°åœ¨ï¼ˆæ¨¡å—åŒ–ç»“æ„ï¼‰

```
backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go      (54 è¡Œ) â¬‡ï¸ å‡å°‘ 93%
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ models.go
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ service.go
â”‚   â”‚   â””â”€â”€ errors.go
â”‚   â”œâ”€â”€ registry/
â”‚   â”‚   â””â”€â”€ registry.go
â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â”œâ”€â”€ apibay.go
â”‚   â”‚   â””â”€â”€ sample.go
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ magnet.go
â”‚       â””â”€â”€ helpers.go
â”œâ”€â”€ go.mod
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## âœ¨ æ”¹è¿›ç‚¹

### 1. **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**
- âœ… æ¯ä¸ªç›®å½•ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
- âœ… æ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… é™ä½è®¤çŸ¥è´Ÿæ‹…

### 2. **æ›´å¥½çš„å°è£…æ€§**
- âœ… `internal/` ç›®å½•é˜²æ­¢å¤–éƒ¨å¯¼å…¥
- âœ… æ¸…æ™°çš„å…¬å¼€æ¥å£
- âœ… å®ç°ç»†èŠ‚éšè—

### 3. **ä¾¿äºæ‰©å±•**
- âœ… æ·»åŠ æ–°é€‚é…å™¨åªéœ€åœ¨ `adapters/` ç›®å½•åˆ›å»ºæ–°æ–‡ä»¶
- âœ… æ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- âœ… ç¬¦åˆå¼€é—­åŸåˆ™

### 4. **æ ‡å‡†åŒ–ç»“æ„**
- âœ… ç¬¦åˆ Go ç¤¾åŒºæ ‡å‡†å¸ƒå±€
- âœ… å…¶ä»– Go å¼€å‘è€…å®¹æ˜“ä¸Šæ‰‹
- âœ… ä¾¿äºå›¢é˜Ÿåä½œ

### 5. **æ˜“äºæµ‹è¯•**
- âœ… æ¯ä¸ªåŒ…å¯ç‹¬ç«‹æµ‹è¯•
- âœ… ä¾¿äºç¼–å†™å•å…ƒæµ‹è¯•
- âœ… æ–¹ä¾¿ mock ä¾èµ–

## ğŸ”§ ä½¿ç”¨æ–¹å¼å˜æ›´

### å¼€å‘æ¨¡å¼ï¼ˆæ— å˜åŒ–ï¼‰

```bash
cd backend
make dev
```

### è¿è¡ŒæœåŠ¡ï¼ˆæ— å˜åŒ–ï¼‰

```bash
make run
```

### ç¼–è¯‘ï¼ˆè·¯å¾„å˜åŒ–ï¼‰

```bash
# ä¹‹å‰
go build -o bin/seedmanage .

# ç°åœ¨
go build -o bin/seedmanage ./cmd/server
# æˆ–ç›´æ¥ä½¿ç”¨
make build
```

### å¯¼å…¥è·¯å¾„å˜åŒ–

å¦‚æœä½ æœ‰å…¶ä»–ä»£ç éœ€è¦å¯¼å…¥è¿™ä¸ªæ¨¡å—ï¼š

```go
// ä¹‹å‰ï¼ˆå‡è®¾ï¼‰
import "github.com/seedmanage/backend"

// ç°åœ¨
import "github.com/seedmanage/backend/internal/models"
import "github.com/seedmanage/backend/internal/service"
// ç­‰ç­‰...
```

## ğŸ“ åŒ…åå’Œå¯¼å‡ºå˜åŒ–

### å‡½æ•°å’Œç±»å‹é‡å‘½å

ä¸ºäº†ç¬¦åˆ Go åŒ…çš„å‘½åè§„èŒƒï¼Œéƒ¨åˆ†å‡½æ•°åšäº†è°ƒæ•´ï¼š

| æ—§åç§° | æ–°åç§° | æ‰€åœ¨åŒ… |
|--------|--------|--------|
| `NewAdapterRegistry()` | `registry.New()` | registry |
| `NewAPIService()` | `service.New()` | service |
| `NewAPIBayAdapter()` | `adapters.NewAPIBay()` | adapters |
| `NewSampleAdapter()` | `adapters.NewSample()` | adapters |
| `getenv()` | `utils.Getenv()` | utils |
| `formatSize()` | `utils.FormatSize()` | utils |
| `buildMagnetLink()` | `utils.BuildMagnetLink()` | utils |
| `parseMagnetLink()` | `utils.ParseMagnetLink()` | utils |
| `ptrInt()` | `utils.PtrInt()` | utils |
| `coalesce()` | `utils.Coalesce()` | utils |
| `methodNotAllowedError()` | `service.NewMethodNotAllowedError()` | service |

### å˜é‡å¯¼å‡º

åŸæ¥åŒ…çº§åˆ«çš„ç§æœ‰å˜é‡ç°åœ¨å¯¼å‡ºä¸ºå…¬å¼€å˜é‡ï¼š

```go
// ä¹‹å‰
var baseTrackers = []string{...}

// ç°åœ¨
// åœ¨ config åŒ…ä¸­
var BaseTrackers = []string{...}
```

## ğŸ¯ ä¸»è¦å˜æ›´ç‚¹

### 1. æ¨¡å—è·¯å¾„

`go.mod` å®šä¹‰äº†æ¨¡å—è·¯å¾„ï¼š

```go
module github.com/seedmanage/backend
```

### 2. ç¨‹åºå…¥å£

ä¸»ç¨‹åºç§»åˆ° `cmd/server/main.go`ï¼Œæ‰€æœ‰å¯åŠ¨é€»è¾‘åœ¨è¿™é‡Œã€‚

### 3. å†…éƒ¨åŒ…

æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ç§»åˆ° `internal/` ç›®å½•ï¼š
- å¤–éƒ¨æ— æ³•ç›´æ¥å¯¼å…¥
- ç¡®ä¿ API ç¨³å®šæ€§
- ä¾¿äºé‡æ„å†…éƒ¨å®ç°

### 4. é€‚é…å™¨ç»„ç»‡

æ‰€æœ‰é€‚é…å™¨ç»Ÿä¸€æ”¾åœ¨ `internal/adapters/` ç›®å½•ï¼Œä¾¿äºç®¡ç†ã€‚

### 5. å·¥å…·å‡½æ•°åˆ†ç±»

å·¥å…·å‡½æ•°æŒ‰åŠŸèƒ½åˆ†ç±»ï¼š
- `utils/magnet.go` - ç£åŠ›é“¾æ¥ç›¸å…³
- `utils/helpers.go` - é€šç”¨è¾…åŠ©å‡½æ•°

## ğŸš€ è¿ç§»æ£€æŸ¥æ¸…å•

- [x] âœ… ä»£ç æŒ‰åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒç›®å½•
- [x] âœ… æ›´æ–° `go.mod` æ¨¡å—è·¯å¾„
- [x] âœ… æ›´æ–° `Makefile` æ„å»ºå‘½ä»¤
- [x] âœ… æ›´æ–° `.air.toml` çƒ­é‡è½½é…ç½®
- [x] âœ… åˆ é™¤æ—§çš„æ ¹ç›®å½•æ–‡ä»¶
- [x] âœ… éªŒè¯ç¼–è¯‘æˆåŠŸ
- [x] âœ… ç¡®ä¿æ—  lint é”™è¯¯
- [x] âœ… æ›´æ–°é¡¹ç›®æ–‡æ¡£
- [x] âœ… åˆ›å»ºæ¶æ„æ–‡æ¡£

## ğŸ§ª éªŒè¯æ­¥éª¤

```bash
# 1. æ¸…ç†æ—§çš„ç¼–è¯‘äº§ç‰©
make clean

# 2. é‡æ–°ç¼–è¯‘
make build

# 3. è¿è¡ŒæœåŠ¡æµ‹è¯•
make run

# 4. æˆ–ä½¿ç”¨å¼€å‘æ¨¡å¼
make dev
```

## ğŸ“š æ–°å¢æ–‡æ¡£

1. **`backend/README.md`** - åç«¯è¯¦ç»†æ–‡æ¡£
2. **`ARCHITECTURE.md`** - æ¶æ„è®¾è®¡æ–‡æ¡£
3. **`MIGRATION.md`** - æœ¬è¿ç§»æŒ‡å—

## ğŸ’¡ å¼€å‘å»ºè®®

### æ·»åŠ æ–°åŠŸèƒ½æ—¶

1. **ç¡®å®šåŠŸèƒ½æ‰€å±é¢†åŸŸ**
   - API ç›¸å…³ â†’ `service/`
   - æ•°æ®æº â†’ `adapters/`
   - å·¥å…·å‡½æ•° â†’ `utils/`
   - æ•°æ®æ¨¡å‹ â†’ `models/`

2. **åˆ›å»ºå¯¹åº”æ–‡ä»¶**
   ```bash
   touch internal/adapters/newadapter.go
   ```

3. **å®ç°å¿…è¦æ¥å£**
   ```go
   type NewAdapter struct {}
   func (a *NewAdapter) Search(...) {...}
   ```

4. **åœ¨ main.go æ³¨å†Œ**
   ```go
   reg.Register(adapters.NewNewAdapter())
   ```

### ä»£ç è§„èŒƒ

- ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–ï¼ˆVS Code é…ç½®å·²æ·»åŠ ï¼‰
- ä½¿ç”¨ `make fmt` æ‰‹åŠ¨æ ¼å¼åŒ–
- å¯¼å‡ºçš„æ ‡è¯†ç¬¦ä½¿ç”¨å¤§å†™å¼€å¤´
- ç§æœ‰æ ‡è¯†ç¬¦ä½¿ç”¨å°å†™å¼€å¤´

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä½¿ç”¨ internal/ ç›®å½•ï¼Ÿ
A: è¿™æ˜¯ Go 1.4+ çš„ç‰¹æ€§ï¼Œç¡®ä¿å†…éƒ¨åŒ…ä¸ä¼šè¢«å¤–éƒ¨æ¨¡å—å¯¼å…¥ï¼Œæä¾›æ›´å¥½çš„å°è£…æ€§ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„é€‚é…å™¨ï¼Ÿ
A: åœ¨ `internal/adapters/` åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå®ç° `models.Adapter` æ¥å£ï¼Œç„¶ååœ¨ `cmd/server/main.go` æ³¨å†Œå³å¯ã€‚

### Q: æ—§ä»£ç è¿˜èƒ½è¿è¡Œå—ï¼Ÿ
A: æ—§ä»£ç å·²åˆ é™¤ã€‚ä½¿ç”¨æ–°ç»“æ„åï¼Œæ‰€æœ‰åŠŸèƒ½å®Œå…¨å…¼å®¹ï¼ŒAPI æ¥å£ä¸å˜ã€‚

### Q: å¦‚ä½•å›æ»šåˆ°ä¹‹å‰çš„ç»“æ„ï¼Ÿ
A: å¯ä»¥é€šè¿‡ git å›é€€åˆ°é‡æ„å‰çš„ commitã€‚ä½†å»ºè®®ä½¿ç”¨æ–°ç»“æ„ï¼Œå®ƒæ›´æ˜“ç»´æŠ¤å’Œæ‰©å±•ã€‚

### Q: æ€§èƒ½æœ‰å½±å“å—ï¼Ÿ
A: æ²¡æœ‰ã€‚è¿™åªæ˜¯ä»£ç ç»„ç»‡æ–¹å¼çš„æ”¹å˜ï¼Œè¿è¡Œæ—¶æ€§èƒ½å®Œå…¨ä¸€è‡´ã€‚

## ğŸ‰ æ€»ç»“

é¡¹ç›®ç°åœ¨æ‹¥æœ‰ï¼š
- âœ… æ¸…æ™°çš„æ¨¡å—åŒ–ç»“æ„
- âœ… æ›´å¥½çš„å¯ç»´æŠ¤æ€§
- âœ… æ›´å¼ºçš„æ‰©å±•æ€§
- âœ… ç¬¦åˆ Go æœ€ä½³å®è·µ
- âœ… å®Œæ•´çš„æ–‡æ¡£

å¼€å‘ä½“éªŒæ›´ä½³ï¼š
- ğŸ”¥ çƒ­é‡è½½æ”¯æŒ
- ğŸ’¾ ä¿å­˜è‡ªåŠ¨æ ¼å¼åŒ–
- ğŸ“¦ æ¨¡å—åŒ–æµ‹è¯•
- ğŸš€ å¿«é€Ÿæ„å»º

---

**é‡ç»„æ—¥æœŸ**: 2025-11-20  
**å½±å“èŒƒå›´**: ä»£ç ç»“æ„è°ƒæ•´ï¼ŒAPI æ¥å£æ— å˜åŒ–  
**å…¼å®¹æ€§**: å®Œå…¨å…¼å®¹

